{% extends "site_base.html" %}

{% load i18n %}

{% block extra_head %}
<link href="{{STATIC_URL}}css/bbs_layout.css" rel="stylesheet" type="text/css" media="screen">
{% endblock %}

{% block content %}
<div class="nav_link">
	<a href="/bbs/">返回</a>
</div>

<div>
	{% if request.user.username == question.author.username %}
	您是本条问题的作者 您可以：
	<a href="{% url edit_question question.id %}">修改内容</a>
	<a href="{% url delete_question question.id %}">删除本条问题</a>
	{% endif %}
</div>

<div style="width:75%;">
	<!--table for rendering a thread-->
	<div class="thread">
	<table>
		<tr class="thread_tr1">
			<td class="thread_td1">
				<span style="margin:5%;margin-left:10%;font-size:1.2em;color:white;">
					{% if question.author %}
						{{ question.author.username }}
					{% else %}
						未登录用户
					{% endif %}
				</span>
			</td>
			<td class="thread_td2">
				<span style="margin:5%;font-size:1.5em;">
					<a href="/bbs/{{question.id}}" style="color:white;" class="thread_title">{{ question.title }}</a>
				</span>
			</td>
		</tr>
		<tr class="thread_tr2">
			<td class="thread_td1">
				{% if question.author.user_profile and question.author.user_profile.profile_img %}
				<img class="profile_img" src="{{question.author.user_profile.profile_img.url}}"/>
				{% else %}
				{% if request.user.user_profile.gender == 'M' %}
				<img class="profile_img" src="{{ MEDIA_URL }}images/male.jpg" />	
				{% else %}
				<img class="profile_img" src="{{ MEDIA_URL }}images/female.jpg" />	
				{% endif %}
				{% endif %}
				{% if question.author.user_profile.role == 'D'%}
					<b>医生</bbs>
				{% endif %}
				</td>
				<td class="thread_td2">
					<span class="content">
						{{ question.content }}
					</span>
				</td>
			</tr>
			<tr>
				<td>
					{% include "thread_profile.html" %}
				</td>
				<td>
					<span style="color:#D8D8D8;font-size:1.15em;float:right;margin-right:2%;">当前答案数({{question.answers.all|length}}) &nbsp &nbsp &nbsp &nbsp{{ question.update_time}}</span>
				</td>
			</tr>
		</table>
	</div>

	{% for answer in question.sorted_answers %}
	<!--table for rendering a thread-->
	<div class="thread">
	<table>
		<tr class="thread_tr1">
			<td class="thread_td1">
				<span style="margin:5%;margin-left:10%;font-size:1.2em;color:white;">
					{{ answer.author.username }}
				</span>
			</td>
			<td class="thread_td2">
				<span style="margin:5%;font-size:1.5em;">
					<a href="/bbs/{{question.id}}" style="color:white;" class="thread_title">回答: {{ question.title }}</a>
				</span>
			</td>
		</tr>
		<tr class="thread_tr2">
			<td class="thread_td1">
				{% if answer.author.user_profile and answer.author.user_profile.profile_img %}
				<img class="profile_img" src="{{answer.author.user_profile.profile_img.url}}"/>
				{% else %}
				{% if request.user.user_profile.gender == 'M' %}
				<img class="profile_img" src="{{ MEDIA_URL }}images/male.jpg" />	
				{% else %}
				<img class="profile_img" src="{{ MEDIA_URL }}images/female.jpg" />	
				{% endif %}
				{% endif %}
				{% if answer.author.user_profile.role == 'D'%}
					<b>医生</bbs>
				{% endif %}
				</td>
				<td class="thread_td2">
					<span class="content">
						{{ answer.content }}
					</span>
				</td>
			</tr>
			<tr>
				<td>
					{% include "answer_profile.html" %}
				</td>
				<td>
					<span style="color:#D8D8D8;font-size:1.15em;float:right;margin-right:2%;"> &nbsp &nbsp &nbsp &nbsp{{ answer.update_time}}</span>
				</td>
			</tr>
		</table>
	</div>
	{% endfor %}
</div>

{% if authenticated %}
<div style="margin-left:-10%;">
	{% include 'user_profile.html' %}
</div>
	<div class="single_form" style="float:left;margin-left:-10%;">
		<form action="" method="post" enctype="multipart/form-data">
			{% csrf_token %}
			<div>您的回答： {{ form.content }}
				<button name="answer" type="submit" class="btn" style="float:right;margin-right:-260%;">回答</button>
			</div>
		</form>
	</div>
{% else %}
	<div class="auth_notify_div">
	    <p>您尚未登录.</p> <p>您可以 <a href="{% url account_login %}" class="btn">登录</a> or <a href="{% url account_signup %}" class="btn primary">注册为用户</a> 开始回答问答区问题 </p>
	</div>
{% endif %}
{% endblock %}